---
globs: backend/**/*.py
---
# DB conventions (Postgres + pgvector + Neo4j)

- Postgres DSN: prefer `DATABASE_URL`; otherwise build from `POSTGRES_*` envs (host defaults to `postgres` in compose).
- Use `uuid_generate_v4()` for primary keys and cast UUID params explicitly (e.g., `%s::uuid`).
- Register pgvector adapter for psycopg2 if available; `embedding` is vector(384).
- For chunk queries that accept `resource_id`, validate non-empty and cast (`%s::uuid`).
- Neo4j merges: create `Concept`, `Chunk`, and `Resource` with MERGE; keep snippet lengths reasonable (<300 chars).
- Avoid logging full query payloads or secrets; prefer summarized diagnostics.
